(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[756],{2963:function(e,a,n){Promise.resolve().then(n.bind(n,5166))},5166:function(e,a,n){"use strict";n.r(a);var t=n(7437),r=n(2265),c=n(4829),o=n(6507),i=n(8024),s=n(2277),l=n(5795),d=n(3701),h=n(6988),x=n(8489),j=n(666),m=n(3226),Z=n(9279),g=n(5421),p=n(3724),u=n(8874),f=n(3878),b=n(4033);let v=e=>{let{cameraId:a}=e,[n,c]=(0,r.useState)("");return(0,r.useEffect)(()=>{let e=window.location.hostname;console.log("Connecting to WebSocket for camera ".concat(a," on ").concat(e));let n=new WebSocket("ws://".concat(e,":8000/ws/frontend/").concat(a));return n.onmessage=e=>{try{let n=JSON.parse(e.data);console.log("Received data keys: ".concat(Object.keys(n).join(", "))),n.camera_id===a&&n.image&&(console.log("Received image data for camera ".concat(a)),c("data:image/jpeg;base64,".concat(n.image)))}catch(e){console.error("Error parsing WebSocket message:",e)}},n.onopen=()=>{console.log("WebSocket connection opened for camera ".concat(a))},n.onclose=()=>{console.log("WebSocket closed for camera ".concat(a,". Attempting to reconnect...")),setTimeout(()=>{window.location.reload()},1e3)},n.onerror=e=>{console.error("WebSocket Error for camera ".concat(a,": "),e)},()=>{n.close()}},[a]),(0,t.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"200px",backgroundColor:"#F0F4FF"},children:[(0,t.jsx)(m.Z,{variant:"h6",component:"h2",gutterBottom:!0}),(0,t.jsx)(o.Z,{component:"img",src:n||"https://via.placeholder.com/300x200?text=No+Stream",alt:"Live Video Stream ".concat(a),sx:{maxWidth:"100%",height:"auto",border:"1px solid #ddd",borderRadius:"5px"}})]})};a.default=()=>{let[e,a]=(0,r.useState)(0),[n,y]=(0,r.useState)([]),S=(0,b.useRouter)();(0,r.useEffect)(()=>{let e=async()=>{try{let e=localStorage.getItem("username"),[a,n]=await Promise.all([c.Z.get("http://13.239.150.70:8000/user_cameras/".concat(e)),c.Z.get("http://13.239.150.70:8000/get_camera_ids")]),t=a.data.cameras.map(e=>({...e,enabled:!1})),r=Object.values(n.data.camera_ids),o=t.map(e=>({...e,enabled:r.includes(e.id)}));y(o)}catch(e){console.error("Error fetching cameras and IDs:",e)}};e()},[]);let k=e=>{S.push("/camera-stream?cameraId=".concat(e))},C=(e,a)=>{let t=n.filter(e=>e.enabled).length;if(!a&&t>=2){alert("You can only enable up to 2 cameras.");return}let r=n.map(n=>n.id===e?{...n,enabled:!a}:n);y(r)},w=async()=>{let e=n.filter(e=>e.enabled);if(2!==e.length){alert("Please select exactly 2 cameras before saving.");return}try{let a=await c.Z.post("http://13.239.150.70:8000/set_camera_ids",{camera_id_1:e[0].id,camera_id_2:e[1].id});alert(a.data.message)}catch(e){console.error("Error saving camera IDs:",e),alert("Failed to save camera IDs. Please try again.")}};return(0,t.jsxs)(o.Z,{children:[(0,t.jsxs)(i.Z,{value:e,onChange:(e,n)=>{a(n)},children:[(0,t.jsx)(s.Z,{label:"List View"}),(0,t.jsx)(s.Z,{label:"Grid View"})]}),0===e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Z,{children:(0,t.jsxs)(d.Z,{"aria-label":"camera list table",children:[(0,t.jsx)(h.Z,{children:(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(j.Z,{children:(0,t.jsx)(m.Z,{color:"textSecondary",variant:"h6",children:"ID"})}),(0,t.jsx)(j.Z,{children:(0,t.jsx)(m.Z,{color:"textSecondary",variant:"h6",children:"Name"})}),(0,t.jsx)(j.Z,{children:(0,t.jsx)(m.Z,{color:"textSecondary",variant:"h6",children:"Channel"})}),(0,t.jsx)(j.Z,{children:(0,t.jsx)(m.Z,{color:"textSecondary",variant:"h6",children:"Enabled"})}),(0,t.jsx)(j.Z,{children:(0,t.jsx)(m.Z,{color:"textSecondary",variant:"h6",children:"Last Modified"})})]})}),(0,t.jsx)(Z.Z,{children:n.map(e=>(0,t.jsxs)(x.Z,{onClick:()=>k(e.id),sx:{cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},children:[(0,t.jsx)(j.Z,{children:(0,t.jsx)(m.Z,{fontSize:"15px",fontWeight:500,children:e.id})}),(0,t.jsx)(j.Z,{children:(0,t.jsxs)(o.Z,{children:[(0,t.jsx)(m.Z,{variant:"h6",fontWeight:600,children:e.displayName}),(0,t.jsx)(m.Z,{color:"textSecondary",fontSize:"13px",children:e.name})]})}),(0,t.jsx)(j.Z,{children:(0,t.jsx)(m.Z,{variant:"body2",children:e.channel})}),(0,t.jsx)(j.Z,{children:(0,t.jsx)(g.Z,{checked:e.enabled,onChange:()=>C(e.id,e.enabled),onClick:e=>e.stopPropagation()})}),(0,t.jsx)(j.Z,{children:(0,t.jsx)(m.Z,{variant:"body2",children:new Date(e.lastModified).toLocaleString()})})]},e.id))})]})}),(0,t.jsx)(o.Z,{mt:2,display:"flex",justifyContent:"flex-end",children:(0,t.jsx)(p.Z,{variant:"contained",color:"primary",onClick:w,children:"Save"})})]}),1===e&&(0,t.jsx)(u.ZP,{container:!0,spacing:2,children:n.map(e=>(0,t.jsx)(u.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsx)(f.Z,{children:(0,t.jsxs)(o.Z,{onClick:()=>k(e.id),sx:{cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},children:[(0,t.jsx)(v,{cameraId:e.id}),(0,t.jsxs)(o.Z,{p:2,sx:{paddingTop:"60px"},children:[(0,t.jsx)(m.Z,{variant:"h6",fontWeight:600,children:e.name}),(0,t.jsxs)(o.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1,children:[(0,t.jsx)(g.Z,{checked:e.enabled,onChange:()=>C(e.id,e.enabled),onClick:e=>e.stopPropagation()}),(0,t.jsxs)(m.Z,{variant:"body2",children:["Last Modified: ",new Date(e.lastModified).toLocaleString()]})]})]})]})})},e.id))})]})}},3878:function(e,a,n){"use strict";var t=n(7437);n(2265);var r=n(5133),c=n(8469),o=n(3226),i=n(3457),s=n(6507);a.Z=e=>{let{title:a,subtitle:n,children:l,action:d,footer:h,cardheading:x,headtitle:j,headsubtitle:m,middlecontent:Z}=e;return(0,t.jsxs)(r.Z,{sx:{padding:0},elevation:9,variant:void 0,children:[x?(0,t.jsxs)(c.Z,{children:[(0,t.jsx)(o.Z,{variant:"h3",children:j}),(0,t.jsx)(o.Z,{variant:"subtitle2",color:"textSecondary",children:m})]}):(0,t.jsxs)(c.Z,{sx:{p:"30px"},children:[a?(0,t.jsxs)(i.Z,{direction:"row",spacing:2,justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,t.jsxs)(s.Z,{children:[a?(0,t.jsx)(o.Z,{variant:"h3",children:a}):"",n?(0,t.jsx)(o.Z,{variant:"subtitle2",color:"textSecondary",children:n}):""]}),d]}):null,l]}),Z,h]})}}},function(e){e.O(0,[370,468,238,937,116,810,863,417,602,971,596,744],function(){return e(e.s=2963)}),_N_E=e.O()}]);